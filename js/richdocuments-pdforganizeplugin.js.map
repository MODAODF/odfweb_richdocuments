{"version":3,"file":"richdocuments-pdforganizeplugin.js?v=cca19bedcc184989d6c7","mappings":"mUAAC,SAAUA,GACVA,EAAIC,eAAiBD,EAAIC,gBAAkB,GAK3CD,EAAIC,eAAeC,cAAgB,CAClCC,OADkC,SAC3BC,GACe,CAAC,QAAS,gBACdC,QAAQD,EAASE,IAAM,GACxCC,KAAKC,mBAAmBJ,IAOzBI,mBAXkC,SAWfJ,GAYlB,IAXA,IAWA,MAXuB,CACtB,0CACA,iDACA,kDACA,qBACA,0EACA,2BACA,oEACA,gCACA,6EAED,eAAmC,CAA9B,IAAMK,EAAI,KACdL,EAASM,YAAYC,eAAe,CACnCC,KAAM,SACNC,YAAaC,EAAE,gBAAiB,eAChCL,KAAAA,EACAM,YAAaC,GAAGC,gBAChBC,KAAMF,GAAGG,UAAU,gBAAiB,SACpCC,cAAeC,IAnBW,SAuBbA,EAvBa,qFAuB5B,WAAqBC,EAAUC,GAA/B,iGACuF,IAAjEA,EAAQnB,SAASoB,QAAQT,YAAcC,GAAGS,oBAA+E,MAAnDF,EAAQnB,SAASsB,IAAIC,KAAK,eAAeC,MADrI,uBAGEZ,GAAGa,QAAQC,MACVhB,EAAE,QAAS,4DACXA,EAAE,gBAAiB,UALtB,mDAWyBiB,MAAMf,GAAGgB,YAAY,sCAX9C,WAWQC,EAXR,QAYgBC,GAZhB,kCAaqBD,EAASE,OAb9B,sFAiBEnB,GAAGa,QAAQC,MACVhB,EAAE,0FACFA,EAAE,gBAAiB,UAnBtB,4BAuBOsB,EAAMhC,EAASiC,uBACjBC,iBAAgB,GACpBF,EAAIG,oBAAoB,GACxBH,EAAII,mBAAmB1B,EAAE,gBAAiB,eAAgB,KAAM,MAChEsB,EAAIK,mBAEEC,EAAUnB,EAAQoB,MAASpB,EAAQoB,MAAMC,KAAK,WAAarB,EAAQsB,OACnEC,EAAevB,EAAQoB,MAASpB,EAAQoB,MAAMC,KAAK,aAAerB,EAAQnB,SAAS2C,sBACrFC,EAAMhC,GAAGgB,YAAY,mCACzBgB,GAAO,WAAaN,EACpBM,GAAO,gBAAkBF,EACG,iBAAxBvB,EAAQnB,SAASE,KACpB0C,GAAO,iBAAmBC,EAAE,iBAAiBrB,OAG9CG,MAAMiB,GAAKE,MAAK,SAAAjB,GACVA,EAASC,IACbD,EAASE,OAAOe,MAAK,SAACf,GACrBnB,GAAGa,QAAQC,MAAMhB,EAAE,gBAAiBqB,GAAOrB,EAAE,gBAAiB,aAGhEsB,EAAII,mBAAmB1B,EAAE,gBAAkBmB,EAASC,GAAM,wBAA0B,SAAU,KAAM,MACpGiB,YAAW,WACVf,EAAIgB,kBACJhB,EAAII,mBAAmB,MACrB,MACHpC,EAASiD,YAjDX,2DAvB4B,yBAjB9B,CA8FErD,KAEHgB,GAAGsC,QAAQC,SAAS,qBAAsBvD,IAAIC,eAAeC,gB","sources":["webpack:///richdocuments/src/pdforganizeplugin.js"],"sourcesContent":["((function(OCA) {\n\tOCA.FilesPdfEditor = OCA.FilesPdfEditor || {}\n\n\t/**\n\t * @namespace OCA.FilesPdfEditor.PreviewPlugin\n\t */\n\tOCA.FilesPdfEditor.PreviewPlugin = {\n\t\tattach(fileList) {\n\t\t\tconst allowedLists = ['files', 'files.public']\n\t\t\tif (allowedLists.indexOf(fileList.id) < 0) return\n\t\t\tthis._extendFileActions(fileList)\n\t\t},\n\n\t\t/**\n\t\t * @param {Object} fileList the fileList info\n\t\t * @private\n\t\t */\n\t\t_extendFileActions(fileList) {\n\t\t\tconst supportedMimes = [\n\t\t\t\t'application/vnd.oasis.opendocument.text',\n\t\t\t\t'application/vnd.oasis.opendocument.spreadsheet',\n\t\t\t\t'application/vnd.oasis.opendocument.presentation',\n\t\t\t\t'application/msword',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n\t\t\t\t'application/vnd.ms-excel',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n\t\t\t\t'application/vnd.ms-powerpoint',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n\t\t\t]\n\t\t\tfor (const mime of supportedMimes) {\n\t\t\t\tfileList.fileActions.registerAction({\n\t\t\t\t\tname: '_toPDF',\n\t\t\t\t\tdisplayName: t('richdocuments', 'Save as PDF'),\n\t\t\t\t\tmime,\n\t\t\t\t\tpermissions: OC.PERMISSION_READ,\n\t\t\t\t\ticon: OC.imagePath('richdocuments', 'topdf'),\n\t\t\t\t\tactionHandler: toPDF\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tasync function toPDF(fileName, context) {\n\t\t\t\tconst isCreatable = (context.fileList.dirInfo.permissions & OC.PERMISSION_CREATE) !== 0 && context.fileList.$el.find('#free_space').val() !== '0'\n\t\t\t\tif (!isCreatable) {\n\t\t\t\t\tOC.dialogs.alert(\n\t\t\t\t\t\tt('files', 'You donâ€™t have permission to upload or create files here'),\n\t\t\t\t\t\tt('richdocuments', 'Error')\n\t\t\t\t\t)\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch(OC.generateUrl('/apps/richdocuments/convert/check'))\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tconst msg = await response.text()\n\t\t\t\t\t\tthrow msg\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tOC.dialogs.alert(\n\t\t\t\t\t\tt('The [convet-to] is not working or unavailable, please contact the system administrator'),\n\t\t\t\t\t\tt('richdocuments', 'Error'))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst bar = fileList._operationProgressBar\n\t\t\t\tbar.showProgressBar(false)\n\t\t\t\tbar.setProgressBarValue(0)\n\t\t\t\tbar.setProgressBarText(t('richdocuments', 'Save as PDF'), null, null)\n\t\t\t\tbar.hideCancelButton()\n\n\t\t\t\tconst fileid = (context.$file) ? context.$file.attr('data-id') : context.fileId\n\t\t\t\tconst destination = (context.$file) ? context.$file.attr('data-path') : context.fileList.getCurrentDirectory()\n\t\t\t\tlet url = OC.generateUrl('/apps/richdocuments/convert/pdf')\n\t\t\t\turl += '?fileid=' + fileid\n\t\t\t\turl += '&destination=' + destination\n\t\t\t\tif (context.fileList.id === 'files.public') {\n\t\t\t\t\turl += '&sharingToken=' + $('#sharingToken').val()\n\t\t\t\t}\n\n\t\t\t\tfetch(url).then(response => {\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\tresponse.text().then((text) => {\n\t\t\t\t\t\t\tOC.dialogs.alert(t('richdocuments', text), t('richdocuments', 'Error'))\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tbar.setProgressBarText(t('richdocuments', (response.ok) ? 'Finished file convert' : 'Error'), null, null)\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tbar.hideProgressBar()\n\t\t\t\t\t\tbar.setProgressBarText('')\n\t\t\t\t\t}, 1500)\n\t\t\t\t\tfileList.reload()\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n})(OCA))\n\nOC.Plugins.register('OCA.Files.FileList', OCA.FilesPdfEditor.PreviewPlugin)\n"],"names":["OCA","FilesPdfEditor","PreviewPlugin","attach","fileList","indexOf","id","this","_extendFileActions","mime","fileActions","registerAction","name","displayName","t","permissions","OC","PERMISSION_READ","icon","imagePath","actionHandler","toPDF","fileName","context","dirInfo","PERMISSION_CREATE","$el","find","val","dialogs","alert","fetch","generateUrl","response","ok","text","bar","_operationProgressBar","showProgressBar","setProgressBarValue","setProgressBarText","hideCancelButton","fileid","$file","attr","fileId","destination","getCurrentDirectory","url","$","then","setTimeout","hideProgressBar","reload","Plugins","register"],"sourceRoot":""}